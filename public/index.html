<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram UserBot</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 500px; margin: 50px auto; padding: 20px; }
        .container { background: #f5f5f5; padding: 30px; border-radius: 10px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #0088cc; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; width: 100%; }
        button:hover { background: #006699; }
        .step { display: none; }
        .step.active { display: block; }
        .alert { padding: 10px; border-radius: 5px; margin-bottom: 15px; display: none; }
        .alert.success { background: #d4ffd4; color: #006400; }
        .alert.error { background: #ffd4d4; color: #640000; }
    </style>
</head>
<body>
    <div class="container">
        <h2>ðŸ¤– Telegram UserBot</h2>
        
        <div id="alert" class="alert"></div>

        <!-- Step 1: Credentials -->
        <div id="step1" class="step active">
            <div class="form-group">
                <label>Phone Number</label>
                <input type="text" id="phone" placeholder="+1234567890">
            </div>
            <div class="form-group">
                <label>API ID</label>
                <input type="text" id="apiId" placeholder="1234567">
            </div>
            <div class="form-group">
                <label>API Hash</label>
                <input type="text" id="apiHash" placeholder="a1b2c3d4e5f6g7h8">
            </div>
            <button onclick="startAuth()">Get Verification Code</button>
        </div>

        <!-- Step 2: Code Input -->
        <div id="step2" class="step">
            <p>ðŸ“± Telegram sent you a code. Enter it below:</p>
            <div class="form-group">
                <label>Verification Code</label>
                <input type="text" id="code" placeholder="12345" maxlength="5">
            </div>
            <button onclick="verifyCode()">Connect UserBot</button>
            <button onclick="showStep(1)" style="background: #666; margin-top: 10px;">Back</button>
        </div>

        <!-- Step 3: Connected -->
        <div id="step3" class="step">
            <h3 style="color: green;">âœ… Connected Successfully!</h3>
            <p>Your UserBot is now running on Render.</p>
            <p>Try sending <strong>/menu</strong> in any Telegram chat!</p>
            <button onclick="resetApp()" style="background: #28a745;">Start New Session</button>
        </div>
    </div>

    <script>
        let currentSessionId = null;

        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `alert ${type}`;
            alert.style.display = 'block';
        }

        function showStep(step) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById(`step${step}`).classList.add('active');
        }

        async function startAuth() {
            const phone = document.getElementById('phone').value;
            const apiId = document.getElementById('apiId').value;
            const apiHash = document.getElementById('apiHash').value;

            if (!phone || !apiId || !apiHash) {
                showAlert('Please fill all fields', 'error');
                return;
            }

            try {
                const response = await fetch('/api/start-auth', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone, apiId, apiHash })
                });

                const data = await response.json();

                if (data.success) {
                    currentSessionId = data.sessionId;
                    showAlert(data.message, 'success');
                    showStep(2);
                } else {
                    showAlert(data.error, 'error');
                }
            } catch (error) {
                showAlert('Network error: ' + error.message, 'error');
            }
        }

        async function verifyCode() {
            const code = document.getElementById('code').value;

            if (!code) {
                showAlert('Please enter the code', 'error');
                return;
            }

            try {
                const response = await fetch('/api/verify-code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ sessionId: currentSessionId, code })
                });

                const data = await response.json();

                if (data.success) {
                    showAlert(data.message, 'success');
                    showStep(3);
                } else {
                    showAlert(data.error, 'error');
                }
            } catch (error) {
                showAlert('Network error: ' + error.message, 'error');
            }
        }

        function resetApp() {
            currentSessionId = null;
            document.getElementById('phone').value = '';
            document.getElementById('apiId').value = '';
            document.getElementById('apiHash').value = '';
            document.getElementById('code').value = '';
            showStep(1);
        }
    </script>
</body>
</html>
